
#ifndef __INCLUDE_FS_DOF_NEAR_GLSL__
#define __INCLUDE_FS_DOF_NEAR_GLSL__

// -----------------------------------------------------------------------------
// Input from engine
// -----------------------------------------------------------------------------
layout(binding = 0) uniform sampler2D ps_Shrunk;
layout(binding = 1) uniform sampler2D ps_Blurred;

// -----------------------------------------------------------------------------
// Input to fragment from VS
// -----------------------------------------------------------------------------
layout(location = 2) in vec2 in_UV;

// -----------------------------------------------------------------------------
// Output to fragment
// -----------------------------------------------------------------------------
layout(location = 0) out vec4 out_Output;

// -----------------------------------------------------------------------------
// Function
// More info at: http://http.developer.nvidia.com/GPUGems3/gpugems3_ch28.html
// -----------------------------------------------------------------------------
void main(void)
{
    // -----------------------------------------------------------------------------
    // Initialize variables
    // -----------------------------------------------------------------------------
    vec3  Color;
    float Coc;
    vec4  Blurred;
    vec4  Shrunk;
    
    // -----------------------------------------------------------------------------
    // get shrunked and blurred value
    // -----------------------------------------------------------------------------
    Shrunk  = texture(ps_Shrunk, in_UV);
    Blurred = texture(ps_Blurred, in_UV);
    
    // -----------------------------------------------------------------------------
    // Calculate Color
    // -----------------------------------------------------------------------------
    Color = Shrunk.rgb;
    
    // -----------------------------------------------------------------------------
    // Generate Coc
    // -----------------------------------------------------------------------------
    Coc = 2.0f * max(Blurred.a, Shrunk.a) - Shrunk.a;

    // -----------------------------------------------------------------------------
    // Return final result
    // -----------------------------------------------------------------------------
    out_Output = vec4(Color.xyz, Coc);
}

#endif // __INCLUDE_FS_DOF_NEAR_GLSL__